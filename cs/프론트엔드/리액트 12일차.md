# AgGrid + React 핵심 정리 

## 1. AgGridReact의 기본 구조

AgGridReact는 React 컴포넌트이지만,
실제 셀 렌더링과 데이터 관리는 AgGrid 내부 엔진이 담당한다.

React의 역할:
- AgGridReact 컴포넌트를 화면에 마운트
- rowData, columnDefs 같은 설정을 props로 전달

AgGrid의 역할:
- 셀 계산
- DOM 생성
- 스크롤, 가상화, 성능 최적화

즉,
React는 "설정 전달자",
AgGrid는 "실제 Grid 엔진"이다.

---

## 2. ref / current / api / columnApi 개념

### useRef
```js
const gridRef = useRef(null);
```

- 나중에 생성될 AgGrid 인스턴스를 담아두는 포인터
- 처음엔 gridRef.current === null

### gridRef.current
- AgGrid가 마운트되면 실제 인스턴스가 들어감

### api
- 그리드 전체를 조작하는 리모컨
- 데이터, 선택, 필터, 스크롤, 레이아웃 제어

자주 쓰는 api:
- sizeColumnsToFit()
- selectAll()
- getSelectedRows()
- applyTransaction()
- refreshCells()

### columnApi
- 컬럼(열)만 조작하는 리모컨
- 컬럼 숨김/보임, 순서, 상태 저장/복원

---

## 3. params.api가 있다는 의미

```js
const onGridReady = (params) => {
  params.api.sizeColumnsToFit();
};
```

- onGridReady는 AgGrid가 직접 호출하는 함수
- params는 AgGrid가 넘겨주는 정보 객체
- params.api는 "Grid API가 생성 완료됨"을 보장

의미를 말로 풀면:
"그리드가 완전히 준비됐고,
이제 이 api로 마음껏 조작해도 된다"

---

## 4. onGridReady의 역할

AgGrid는 React 렌더링과 다른 생명주기를 가진다.

Grid 내부 순서:
1. AgGridReact 마운트
2. Grid 인스턴스 생성
3. 컬럼/로우 초기화
4. api 생성
5. onGridReady 호출

그래서 api를 안전하게 쓰려면:
- onGridReady 안
- 또는 이미 준비된 이후(ref.current.api)

---

## 5. sizeColumnsToFit() 이란?

```js
params.api.sizeColumnsToFit();
```

의미:
- 현재 그리드 컨테이너의 실제 가로폭(px)을 기준으로
- 모든 컬럼 폭을 자동으로 분배해 꽉 채운다

내부 동작:
1. 그리드 DOM 폭 측정
2. 컬럼 목록 확인
3. minWidth / maxWidth 고려
4. 폭 재분배

주의:
- 그리드가 준비되기 전에는 호출 불가
- DOM 폭이 바뀐 뒤에 호출해야 정확함

---

## 6. 버튼 클릭 시 그리드는 준비되어 있는가?

```js
const toggleWidthAndFit = () => {
  setWide(prev => !prev);
  requestAnimationFrame(() => {
    gridRef.current.api.sizeColumnsToFit();
  });
};
```

결론:
- 버튼을 누를 수 있는 시점이면
- 그리드는 이미 준비 완료 상태

이유:
- 같은 React 컴포넌트 안에 있으면
- 버튼과 그리드는 같은 생명주기를 공유
- 사용자가 버튼을 클릭할 수 있다는 것은
  이미 화면과 그리드가 렌더링 완료됐다는 뜻

requestAnimationFrame을 쓰는 이유:
- 그리드 준비 때문이 아니라
- React 상태 변경 후 DOM 폭 반영을 기다리기 위해서

---

## 7. setRowData와 Grid 갱신

### React 방식
```js
setRowData(newArray);
```

- React state 변경
- AgGridReact에 새 rowData props 전달
- AgGrid가 내부적으로 갱신 판단

중요:
- 반드시 새 배열을 전달해야 함
```js
setRowData(prev => [...prev, newRow]);
```

---

## 8. getRowId의 역할 (실무 필수)

```js
<AgGridReact
  getRowId={(params) => params.data.id}
/>
```

역할:
- 각 행을 고유 ID로 식별
- 변경된 행만 갱신 가능
- 선택 상태, 스크롤 유지에 매우 중요

없으면:
- 전체 갱신 느낌
- 체크박스 선택 해제
- 화면 흔들림

---

## 9. setRowData vs applyTransaction

### setRowData
- 전체 데이터 교체
- 단순, 직관적
- 중소 데이터에 적합

### applyTransaction
```js
api.applyTransaction({
  add: [...],
  update: [...],
  remove: [...]
});
```

- 부분 변경 명확
- 대용량 데이터에 유리
- 성능 최적화 가능

---

## 10. cellRenderer 관련 개념 정리

### valueFormatter
- 값만 문자열로 변환
- 가장 가볍고 빠름

### valueGetter
- 계산된 값 생성
- 파생 컬럼용

### cellRenderer
- React 없이 DOM/문자열 렌더링
- 배지, 색상, 아이콘에 적합

### cellRendererFramework (rendererFramework)
- 셀 하나를 React 컴포넌트로 렌더링
- 버튼, 클릭, 상태, 훅 사용 가능
- 무겁기 때문에 꼭 필요한 컬럼에만 사용

rendererFramework의 본질:
"AgGrid가 셀 렌더링을 React에게 위임하는 다리"

---

## 11. rendererFramework를 조심해서 써야 하는 이유

- 셀 하나마다 React 컴포넌트 생성
- 대용량 Grid에서 성능 저하 가능

실무 권장:
- 대부분: valueFormatter / cellStyle
- 액션 컬럼 1~2개만 rendererFramework

---

## 12. 전체 흐름 요약

1. React가 AgGridReact를 렌더링
2. AgGrid가 내부 Grid 엔진 생성
3. api 생성
4. onGridReady 호출 (params.api 제공)
5. 이후 버튼, effect, 이벤트에서 api 사용
6. setRowData / applyTransaction으로 데이터 갱신
7. 필요 시 sizeColumnsToFit으로 레이아웃 재조정

---

## 13. 핵심 한 문장 요약

- AgGrid는 React가 아니라 Grid 엔진이다
- React는 설정만 전달한다
- api는 그리드 조작 리모컨이다
- params.api는 "이제 써도 된다"는 공식 보증이다
- sizeColumnsToFit은 DOM 폭 기준 자동 정렬이다
- rendererFramework는 React 위임용이고 남용하면 안 된다
