# 커스텀 훅을 훅으로 처리하는 진짜 조건 정리

이 문서는 **“커스텀 훅이 언제/왜 훅처럼 동작하는가”**를  
React 내부 동작 기준으로 정확히 정리한 자료다.

---

## 1. 결론 한 줄 (정답)

> **커스텀 훅은 그 자체가 훅으로 처리되지 않는다.  
> 렌더링 중에 호출될 때,  
> 커스텀 훅 내부에서 호출된 React 훅(useState, useEffect 등)만이  
> 훅으로 처리되어 슬롯을 차지한다.**

---

## 2. 자주 하는 오해

### ❌ 오해 1  
“커스텀 훅도 하나의 훅이라서 슬롯을 가진다”

→ 틀림  
- 커스텀 훅에는 Fiber가 없다  
- Fiber가 없으면 슬롯도 없다

---

### ❌ 오해 2  
“이름이 use로 시작하면 자동으로 훅이다”

→ 틀림  
- React 런타임은 함수 이름을 보지 않는다  
- `use` 접두사는 **eslint 규칙용 힌트**일 뿐이다

---

### ❌ 오해 3  
“Rules of Hooks를 지키면 자동으로 훅 처리된다”

→ 틀림  
- 규칙은 **필요 조건**이지 **충분 조건**이 아니다

---

## 3. React가 훅으로 처리하는 진짜 조건 (핵심)

React가 어떤 호출을 **훅으로 처리**하려면  
아래 3가지가 동시에 만족되어야 한다.

---

### 조건 1. 렌더링 중이어야 한다

- 함수 컴포넌트 실행 중
- 또는 그 안에서 호출된 함수 실행 중

```js
function App() {
  useCounter(); // 렌더링 중
}
```

❌ 이벤트 핸들러, setTimeout, 일반 함수 실행 중 → 렌더링 아님

---

### 조건 2. Hook Dispatcher가 활성화되어 있어야 한다

React는 렌더 시작 시 내부적으로 다음을 설정한다.

```txt
ReactCurrentDispatcher.current = HooksDispatcherOnMount
또는 HooksDispatcherOnUpdate
```

이 상태에서만 다음 호출이 유효하다.

```js
useState(...)
```

렌더가 끝나면 dispatcher는 null로 돌아간다.

---

### 조건 3. React가 제공한 훅 API를 호출해야 한다

아래와 같은 **React 훅 API**여야 한다.

```txt
useState
useEffect
useRef
useReducer
useMemo
useCallback
useContext
```

이 함수들이 dispatcher를 통해 호출될 때만  
Hook 객체가 생성/재사용된다.

---

## 4. “커스텀 훅이 훅처럼 동작하는” 정확한 판별식

```txt
렌더링 중
∧ Hook Dispatcher 활성
∧ 커스텀 훅 내부에서 React 훅 API 호출
⇒ Hook 슬롯 생성/재사용
```

중요:
- 커스텀 훅 자체는 슬롯을 차지하지 않는다
- **내부에서 호출된 React 훅만** 슬롯을 차지한다
- 슬롯의 주인은 항상 “커스텀 훅을 호출한 컴포넌트”

---

## 5. Rules of Hooks는 왜 필요한가?

Rules of Hooks:

1) 컴포넌트 또는 커스텀 훅에서만 호출  
2) 최상단(top-level)에서만 호출  
3) 매 렌더마다 동일한 순서/개수로 호출  

이 규칙의 목적은 하나다.

> **위 3가지 “진짜 조건”이 항상 성립하도록 강제하기 위함**

규칙 자체가 훅을 만들지는 않는다.

---

## 6. 훅으로 처리되지 않는 예제들

### 6.1 이름은 use지만 훅 아님

```js
function useSum(a, b) {
  return a + b;
}
```

- 렌더링 중 호출 가능
- 하지만 React 훅 API 호출 ❌
- → 슬롯 생성 ❌
- → 그냥 일반 함수

---

### 6.2 React 훅을 쓰지만 렌더링 중이 아님

```js
function useBad() {
  function run() {
    useState(0); // ❌ dispatcher 없음
  }
  run();
}
```

- useState 호출됨
- 하지만 렌더링 컨텍스트 ❌
- → Invalid hook call 오류

---

## 7. 슬롯 관점에서 본 커스텀 훅

```js
function useCounter() {
  const [count, setCount] = useState(0);
  return { count, setCount };
}

function App() {
  const a = useCounter();
  const b = useCounter();
}
```

슬롯 구조(개념):

```txt
App Fiber
 ├─ Hook#0 → a.count
 └─ Hook#1 → b.count
```

- useCounter 정의는 하나
- 호출할 때마다 슬롯은 새로 소비
- 상태는 독립
- 상태 공유 ❌

---

## 8. 한 문단 최종 요약 (면접용)

> **커스텀 훅은 React 런타임에서 별도로 인식되는 개념이 아니며,  
> 렌더링 중 Hook Dispatcher가 활성화된 상태에서  
> 커스텀 훅 내부에서 호출된 useState, useEffect 같은  
> React 훅 API만이 실제로 훅으로 처리된다.  
> Rules of Hooks는 이 조건이 항상 유지되도록 강제하기 위한 규칙이다.**

---

## 9. 핵심 문장 하나로 끝내기

> **커스텀 훅은 훅이 아니다.  
> 훅처럼 보이는 이유는 내부에서 호출한 React 훅이  
> 호출한 컴포넌트의 슬롯을 차지하기 때문이다.**
