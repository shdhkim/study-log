# React + JavaScript 실행 순서 퀴즈 (이벤트 루프 · 렌더링 · batching)

이 문서는 **React + JavaScript(브라우저, React 18 기준)** 기반으로 만들어짐 


---

## 문제 1. 기본 실행 순서

```jsx
console.log("A");

Promise.resolve().then(() => {
  console.log("B");
});

setTimeout(() => {
  console.log("C");
}, 0);

console.log("D");
```

### 질문
1. 콘솔 출력 순서는?
2. B와 C 중 무엇이 먼저 실행되는 이유는?

---

## 문제 2. React 이벤트 핸들러 + batching

```jsx
function App() {
  const [count, setCount] = React.useState(0);

  const onClick = () => {
    setCount(1);
    setCount(2);
    console.log("click");
  };

  console.log("render", count);

  return <button onClick={onClick}>+</button>;
}
```

### 질문
1. 클릭 1번 시 `render`는 몇 번 호출되는가?
2. 화면에 보이는 최종 count 값은?
3. 왜 그렇게 되는가?

---

## 문제 3. 이벤트 핸들러 + Promise

```jsx
function App() {
  const [text, setText] = React.useState("0");

  const onClick = () => {
    setText("1");

    Promise.resolve().then(() => {
      setText("2");
    });
  };

  return <button onClick={onClick}>{text}</button>;
}
```

### 질문
1. 클릭 후 화면에는 무엇이 보일 확률이 높은가?
2. setText("1")이 안 보일 수 있는 이유는?

---

## 문제 4. setTimeout으로 batching 끊기

```jsx
function App() {
  const [n, setN] = React.useState(0);

  const onClick = () => {
    setN(1);

    setTimeout(() => {
      setN(2);
    }, 0);
  };

  return <button onClick={onClick}>{n}</button>;
}
```

### 질문
1. 렌더링은 몇 번 발생하는가?
2. 화면 변화 순서는?

---

## 문제 5. 렌더링(paint) 타이밍

```jsx
function App() {
  const [text, setText] = React.useState("0");

  const onClick = () => {
    setText("1");

    const start = Date.now();
    while (Date.now() - start < 500) {}

    setText("2");
  };

  return <button onClick={onClick}>{text}</button>;
}
```

### 질문
1. 왜 "1"이 화면에 안 보일 수 있는가?
2. 실제로 화면에 보일 가능성이 가장 높은 값은?

---

## 문제 6. flushSync

```jsx
import { flushSync } from "react-dom";

function App() {
  const [text, setText] = React.useState("0");

  const onClick = () => {
    flushSync(() => {
      setText("1");
    });

    const start = Date.now();
    while (Date.now() - start < 500) {}

    setText("2");
  };

  return <button onClick={onClick}>{text}</button>;
}
```

### 질문
1. flushSync가 없는 경우와의 차이점은?
2. "1"이 보일 확률이 높아지는 이유는?

---

## 문제 7. 복합 문제 (최종)

```jsx
function App() {
  const [v, setV] = React.useState(0);

  const onClick = async () => {
    setV(1);

    await Promise.resolve();
    setV(2);

    setTimeout(() => {
      setV(3);
    }, 0);
  };

  return <button onClick={onClick}>{v}</button>;
}
```

### 질문
1. 화면 변화 순서를 예측하라
2. batching이 적용되는 구간은 어디인가?
3. 렌더링은 총 몇 번 발생하는가?

---

# 정답 및 해설

## 문제 1 정답
출력: `A → D → B → C`  
이유: Promise는 마이크로태스크, setTimeout은 매크로태스크

---

## 문제 2 정답
1. render 1번  
2. count = 2  
3. 같은 이벤트 핸들러 안에서 batching

---

## 문제 3 정답
1. "2"  
2. 같은 이벤트 루프 턴에서 batching되어 한 번에 커밋

---

## 문제 4 정답
1. 렌더링 2번  
2. `1 → 2`

---

## 문제 5 정답
1. 콜스택이 비지 않아 paint 불가  
2. "2"

---

## 문제 6 정답
1. flushSync는 즉시 commit  
2. DOM이 즉시 반영되기 때문

---

## 문제 7 정답
1. `0 → 2 → 3`  
2. 이벤트 핸들러 + microtask 구간  
3. 렌더링 2번

---

## 요약

> React에서는 **같은 이벤트 루프 턴**이면 상태 업데이트가 batching되고,  
> 화면에 보이는 시점은 **React 커밋 + 브라우저 paint 이후**다.
