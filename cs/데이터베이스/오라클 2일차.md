# Oracle ROLLUP / CUBE / GROUP BY 총정리

본 문서는 지금까지 다룬 **ROLLUP, CUBE, GROUP BY 확장 집계**를 하나의 흐름으로 정리한 자료이다.
(Oracle SQL 기준)

---

## 1. 기본 데이터 예제

```sql
SALES
---------------------------------------
YEAR   REGION   PRODUCT   AMOUNT
---------------------------------------
2024   SEOUL    TV        100
2024   SEOUL    PHONE     200
2024   BUSAN    TV        150
2024   BUSAN    PHONE     50
2025   BUSAN    TABLET    100
```

### 차원(Dimension) 값 개수

* YEAR: 2 (2024, 2025)
* REGION: 2 (SEOUL, BUSAN)
* PRODUCT: 3 (TV, PHONE, TABLET)

---

## 2. ROLLUP 개념 정리

### 정의

* **계층형 집계**
* 왼쪽 → 오른쪽 컬럼 순서대로 제거하며 소계 생성

```sql
GROUP BY ROLLUP (YEAR, REGION, PRODUCT)
```

### 생성되는 그룹 구조

```
(YEAR, REGION, PRODUCT)
(YEAR, REGION)
(YEAR)
()
```

### 그룹별 실제 행 수

| 그룹                      | 행 수 |
| ----------------------- | --- |
| (YEAR, REGION, PRODUCT) | 5   |
| (YEAR, REGION)          | 3   |
| (YEAR)                  | 2   |
| ()                      | 1   |

**총 행 수 = 11**

### 특징 요약

* 계층형 보고서에 최적
* 구조 고정
* 경우의 수 = 컬럼 수 + 1

---

## 3. CUBE 개념 정리

### 정의

* **모든 차원 조합에 대한 집계**
* 순서 무관

```sql
GROUP BY CUBE (YEAR, REGION, PRODUCT)
```

### 생성되는 그룹 구조 (2³)

```
(YEAR, REGION, PRODUCT)
(YEAR, REGION)
(YEAR, PRODUCT)
(REGION, PRODUCT)
(YEAR)
(REGION)
(PRODUCT)
()
```

### 그룹별 실제 행 수

| 그룹                      | 행 수 |
| ----------------------- | --- |
| (YEAR, REGION, PRODUCT) | 5   |
| (YEAR, REGION)          | 3   |
| (YEAR, PRODUCT)         | 3   |
| (REGION, PRODUCT)       | 5   |
| (YEAR)                  | 2   |
| (REGION)                | 2   |
| (PRODUCT)               | 3   |
| ()                      | 1   |

**총 행 수 = 24**

---

## 4. ROLLUP vs CUBE 비교

| 항목     | ROLLUP | CUBE    |
| ------ | ------ | ------- |
| 집계 구조  | 계층형    | 모든 조합   |
| 경우의 수  | n + 1  | 2ⁿ      |
| 결과 행 수 | 적음     | 많음      |
| 내부 연산량 | 낮음     | 매우 큼    |
| 용도     | 보고서    | OLAP 분석 |

---

## 5. 내부 연산 관점 (중요)

### CUBE 내부 집계 구조

* 논리적으로 **GROUP BY를 2ⁿ번 수행**
* 각 원본 행은 모든 집계 그룹에 참여

### 예제 기준

* 원본 행: 5
* CUBE 그룹: 8

```
총 집계 연산 = 5 × 8 = 40
```

ROLLUP의 경우:

```
5 × 4 = 20
```

👉 **CUBE는 결과 행이 많아서가 아니라, 내부 연산이 폭발**

---

## 6. 왜 CUBE가 위험한가?

* 차원 하나 추가 시 연산량 2배
* PRODUCT처럼 값이 많은 컬럼이 포함되면 결과 급증
* OLTP 환경에서 사용 시 심각한 성능 저하

---

## 7. 실무 판단 기준

| 상황               | 선택                      |
| ---------------- | ----------------------- |
| 연도 → 조직 → 항목 보고서 | ROLLUP                  |
| 자유로운 다차원 분석      | CUBE                    |
| 대용량 데이터          | ROLLUP 또는 GROUPING SETS |

---

## 8. 핵심 한 줄 요약

* **ROLLUP**: 계층형 요약, 구조 안정
* **CUBE**: 모든 경우의 수, 연산 폭발
* **CUBE는 결과보다 내부 비교 비용이 문제**

---

## 9. PIVOT (행 → 열 변환)

### 개념

* 집계된 **행 데이터를 열 형태로 회전**
* 통계 / 리포트 출력에 사용

### 기본 문법

```sql
SELECT *
FROM (
    SELECT 기준컬럼, 피벗컬럼, 값컬럼
    FROM 테이블
)
PIVOT (
    집계함수(값컬럼)
    FOR 피벗컬럼 IN (값1 AS 별칭1, 값2 AS 별칭2)
);
```

### 예제

```sql
SELECT *
FROM (
    SELECT YEAR, REGION, AMOUNT
    FROM SALES
)
PIVOT (
    SUM(AMOUNT)
    FOR REGION IN ('SEOUL' AS SEOUL, 'BUSAN' AS BUSAN)
);
```

### 결과 구조

| YEAR | SEOUL | BUSAN |
| ---- | ----- | ----- |
| 2024 | 300   | 200   |
| 2025 | 0     | 100   |

### 특징

* IN 절 값은 고정 필요
* 내부적으로 GROUP BY + CASE 구조

---

## 10. USING 절 (JOIN 단축 문법)

### 개념

* JOIN 대상 컬럼명이 **양쪽 테이블에서 동일할 때** 사용

### 문법

```sql
SELECT *
FROM A
JOIN B USING (컬럼명);
```

### ON vs USING 비교

```sql
-- ON 방식
SELECT *
FROM EMP e
JOIN DEPT d ON e.DEPTNO = d.DEPTNO;

-- USING 방식
SELECT *
FROM EMP
JOIN DEPT USING (DEPTNO);
```

### USING 특징

* 컬럼명 동일 필수
* SELECT 시 테이블명.컬럼 사용 불가
* 결과 컬럼은 1개만 표시

---

## 11. 최종 핵심 요약

* **ROLLUP**: 계층형 집계 (n + 1)
* **CUBE**: 모든 조합 집계 (2ⁿ, 내부 연산 폭발)
* **PIVOT**: 행 → 열 변환 (리포트용)
* **USING**: JOIN 조건 단축 문법

---


