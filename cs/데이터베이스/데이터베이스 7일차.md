# Oracle TM 락 모드 정리
(X / RX / S / SRX)

작성 기준: Oracle Database

---

## 1. 전제

여기서는 **테이블 락(TM)** 의 **모드 이름(X, RX, S, SRX)** 를 정리한다.  


목표:
- 각 모드가 **무엇을 허용하고 무엇을 막는지**
- **서로 충돌하는지 / 공존하는지**
- 실무에서 **언제 등장하는지**
를 직관적으로 이해하는 것

---

## 2. TM 락 모드 한 줄 요약

| 모드 | 한 줄 요약 |
|---|---|
| X | 테이블 완전 독점 |
| RX | DML 공존, DDL 차단 |
| S | 읽기만 허용 |
| SRX | 읽기만 허용 + 강한 봉인 |

---

## 3. TM(X) – Exclusive Mode

### 의미
- 테이블을 **완전히 혼자 사용**
- 다른 어떤 접근도 허용하지 않음

### 허용 / 차단

| 작업 | 가능 여부 |
|---|---|
| SELECT | 불가 |
| INSERT | 불가 |
| UPDATE | 불가 |
| DELETE | 불가 |
| DDL | 불가 |

### 특징
- 단 하나의 세션만 접근 가능
- 유지 시간이 길면 시스템 영향 큼
- 실무에서는 거의 사용하지 않음

---

## 4. TM(RX) – Row Exclusive Mode

### 의미
- **행은 각자 독점**
- **테이블은 공유**

### 허용 / 차단

| 작업 | 가능 여부 |
|---|---|
| SELECT | 가능 |
| INSERT | 가능 |
| UPDATE | 가능 |
| DELETE | 가능 |
| DDL | 불가 |

### 특징
- 대부분의 DML이 자동으로 획득
- RX ↔ RX는 공존 가능
- 실제 충돌은 행 단위에서 발생

### 대표 상황
```sql
INSERT / UPDATE / DELETE
SELECT ... FOR UPDATE
```

---

## 5. TM(S) – Share Mode

### 의미
- 테이블을 **읽기 전용 상태**로 보호

### 허용 / 차단

| 작업 | 가능 여부 |
|---|---|
| SELECT | 가능 |
| INSERT | 불가 |
| UPDATE | 불가 |
| DELETE | 불가 |
| DDL | 불가 |

### 특징
- 여러 세션이 동시에 획득 가능
- “읽기만 되고 수정 안 되는 락”의 대표
- 실무에서는 거의 사용하지 않음

---

## 6. TM(SRX) – Share Row Exclusive Mode

### 의미
- 읽기는 허용
- **DML을 강하게 차단**

### 허용 / 차단

| 작업 | 가능 여부 |
|---|---|
| SELECT | 가능 |
| INSERT | 불가 |
| UPDATE | 불가 |
| DELETE | 불가 |
| DDL | 불가 |

### 특징
- S보다 강함
- RX와도 공존 불가
- 실무에서는 거의 사용되지 않음

---

## 7. TM 락 모드 호환성(공존 가능 여부)

| 보유 \\ 요청 | X | RX | S | SRX |
|---|---|---|---|---|
| **X** | 불가 | 불가 | 불가 | 불가 |
| **RX** | 불가 | 가능 | 불가 | 불가 |
| **S** | 불가 | 불가 | 가능 | 불가 |
| **SRX** | 불가 | 불가 | 불가 | 불가 |

---

## 8. 헷갈리는 포인트 정리

### 1) RX인데 왜 다들 UPDATE가 되나?
- RX는 **테이블 락**
- 행 충돌은 **TX(행 락)** 에서 제어

### 2) UPDATE 중인데 SELECT는 왜 되나?
- RX 때문이 아니라
- Oracle이 **Undo(MVCC)** 로 읽기 처리

### 3) 읽기만 가능하게 만들고 싶으면?
- TM(S) 또는 TM(SRX)

### 4) 락 걸었는데 나도 수정 안 되는 경우
- TM(S) 상태에서 UPDATE 시도
- S → RX 락 업그레이드 대기

---

## 9. 최종 암기용 요약

- X : 전부 막음
- RX : DML 가능, DDL 불가
- S : 읽기만 가능
- SRX : 읽기만 가능 + 더 강함

---
