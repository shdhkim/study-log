# Spring Cloud, Eureka, VPC, IP, DNS 정리

## 1. Spring Cloud의 역할 개요

Spring Cloud는 마이크로서비스 환경에서 서비스 간 통신을 안정적으로
만들기 위한 애플리케이션 레벨 프레임워크다.

Kubernetes: 서버 실행/배치/복구 (인프라 레벨) Spring Cloud: 서비스 호출
제어/정책 (애플리케이션 레벨)

구성 요소: - Service Discovery (Eureka) - Client Load Balancing - Feign
Client - Circuit Breaker - Retry / Timeout / Fallback - Gateway - Config
관리

------------------------------------------------------------------------

## 2. Eureka 서버란 무엇인가

Eureka는 서비스 위치를 관리하는 서버다.

기능: - 각 서비스의 IP와 포트 등록 - 살아있는 인스턴스 목록 제공 - 헬스
체크(Heartbeat)

동작 흐름: 1) 서비스 기동 시 자신을 등록 2) 주기적으로 생존 신호 전송 3)
다른 서비스가 위치 조회

예: USER-SERVICE -\> 10.0.1.23:8080 등록

------------------------------------------------------------------------

## 3. 서비스 등록 과정

서비스 설정:

spring.application.name = user-service

Eureka 설정:

defaultZone: http://eureka.internal:8761/eureka

서비스 기동 시: POST /eureka/apps/user-service

내용: - 서비스 이름 - 사설 IP - 포트

Eureka는 이를 메모리에 저장한다.

------------------------------------------------------------------------

## 4. 서비스 호출 과정 (Feign Client)

Order 서비스 코드:

@FeignClient(name="user-service")

호출 과정: 1) Order -\> Eureka 위치 질의 2) 인스턴스 목록 반환 3)
LoadBalancer가 서버 선택 4) HTTP 요청 수행

실제 요청: http://10.0.1.24:8080/users/1

즉 내부적으로는 REST HTTP 통신이다.

------------------------------------------------------------------------

## 5. 장애 처리 (Circuit Breaker)

문제: USER 서비스 지연 -\> ORDER 대기 -\> 전체 서비스 지연

해결: - Timeout - Retry - Fallback

예: USER 장애 시 캐시 데이터 반환

이를 Cascading Failure 방지라고 한다.

------------------------------------------------------------------------

## 6. VPC와 통신

같은 VPC: - 사설 IP 통신 가능 - HTTP 가능 - 인터넷 경유 없음

다른 VPC: - 사설 IP 접근 불가 - Public 주소 필요 - HTTPS 권장

VPC Peering: - 사설망 연결 - 내부 통신 가능

------------------------------------------------------------------------

## 7. IP 종류

### Public IP

-   자동 할당
-   Stop/Start 시 변경

### Private IP

-   인스턴스 유지 시 유지
-   재생성 시 변경

### Elastic IP

-   계정 소유
-   재연결 가능
-   고정 외부 IP

------------------------------------------------------------------------

## 8. 왜 IP 대신 서비스 이름을 쓰는가

문제: 서버 교체/스케일링 시 IP 변경

해결: 서비스 이름 사용

user-service -\> Eureka -\> 실제 IP 매핑

개발자는 IP를 몰라도 된다.

------------------------------------------------------------------------

## 9. Eureka 서버 IP 문제

Eureka도 서버이므로 IP 변경 가능.

잘못된 방식: defaultZone: http://10.0.0.5:8761/eureka

올바른 방식: defaultZone: http://eureka.internal:8761/eureka

해결: - 내부 DNS(Route53 Private Hosted Zone) - Load Balancer - Eureka
Cluster

------------------------------------------------------------------------

## 10. DNS의 역할

DNS는 이름을 실제 IP로 변환한다.

예: eureka.internal -\> 10.0.0.21

Eureka 교체 시 DNS만 변경하면 전체 서비스 정상 동작.

------------------------------------------------------------------------

## 11. Spring Cloud와 Kubernetes 관계

Kubernetes가 대체하는 것: - 서비스 위치 찾기 - 내부 로드밸런싱 -
헬스체크

Spring Cloud가 계속 담당: - Retry - Timeout - Circuit Breaker - Feign
호출 - 호출 정책

즉: Kubernetes = 연결 Spring Cloud = 호출 제어

------------------------------------------------------------------------

## 12. 내부 통신 프로토콜

같은 VPC: Spring -\> FastAPI HTTP 가능

다른 VPC: 인터넷 경유 HTTPS 필요

Mixed Content와는 다른 개념이며 보안 문제다.

------------------------------------------------------------------------

## 13. 최종 정리

-   IP는 서버 주소이며 변경된다.
-   서비스 이름은 논리 주소이며 안정적이다.
-   Eureka는 내부 DNS 역할을 수행한다.
-   Spring Cloud는 동적 주소 관리 + 장애 제어 레이어다.
-   Kubernetes는 서버 운영 플랫폼이다.
