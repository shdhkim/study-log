# AWS와 온프레미스 환경의 IP 할당 및 배포 구조

## 1. 개요

IP 주소는 인터넷 전체에서 고유하게 관리되며, IANA(국제 인터넷 주소 관리 기관)가 이를 전 세계 지역기관(RIR)에 분배합니다.  
AWS 같은 클라우드 사업자와 온프레미스(자체 서버) 환경 모두 이 IP 체계를 기반으로 네트워크를 구성하지만,  
IP의 할당과 사용 방식은 조금 다릅니다.

---

## 2. AWS 환경의 IP 구조

### (1) 기본 개념
AWS는 IANA로부터 공식적으로 IP 대역을 부여받고, 이를 각 리전(Region)별로 관리합니다.  
EC2 인스턴스는 VPC(가상 사설망) 내에서 사설 IP를 자동으로 할당받고, 필요 시 공인 IP를 연결합니다.

```
IANA → RIR(APNIC/ARIN 등) → AWS → VPC → EC2
```

| 단계 | 역할 | 예시 |
|------|------|------|
| IANA | 전 세계 IP 주소 총괄 관리 | IPv4/IPv6 전 세계 분배 |
| RIR | 대륙별로 분배 (ARIN, APNIC 등) | AWS 미국 리전 = ARIN, 한국 리전 = APNIC |
| AWS | 공인 IP 대역 보유 및 VPC 내부망 구성 | 서울 리전: 13.124.0.0/15 |
| VPC | AWS가 제공하는 가상 사설망 | 10.0.0.0/16 |
| EC2 | VPC 내 사설 IP, 필요 시 공인 IP 연결 | 10.0.1.23 + 13.124.55.200 |

---

### (2) VPC 내부 구조 예시

```
VPC CIDR: 10.0.0.0/16
 ├─ 서브넷: 10.0.1.0/24
 │   ├─ EC2 인스턴스: 10.0.1.25 (사설 IP)
 │   └─ 공인 IP 연결 (예: 13.124.55.200)
```

- 사설망 통신: EC2 간 내부 트래픽은 사설 IP 기반
- 외부 통신: NAT 게이트웨이 또는 인터넷 게이트웨이를 통해 AWS의 공인 IP로 변환

---

### (3) AWS 공인 IP 예시

| 리전 | 공인 IP 대역 |
|------|---------------|
| 서울(ap-northeast-2) | 13.124.0.0/15, 15.164.0.0/16 |
| 도쿄(ap-northeast-1) | 13.112.0.0/15 |
| 버지니아(us-east-1) | 3.80.0.0/12 |
| 런던(eu-west-2) | 18.132.0.0/16 |

---

## 3. 온프레미스 환경의 IP 구조

온프레미스(On-Premises) 환경은 조직 내부에 직접 서버·네트워크 장비를 구축한 형태입니다.  
공인 IP는 외부 통신용으로 1개 이상만 사용하고, 내부 서버들은 사설 IP로 구성됩니다.

### (1) 기본 구조 예시

```
[인터넷]
   ↓
[공인 IP: 211.33.55.10] ← ISP(통신사)에서 받은 IP
   ↓
[방화벽 or 라우터]
   ↓
[사설망: 192.168.0.0/16]
      ├─ 웹서버 (192.168.0.10)
      ├─ DB서버 (192.168.0.20)
      ├─ 내부PC (192.168.0.30)
```

- 공인 IP: 외부 인터넷과 연결되는 “출입구” 역할
- 사설 IP: 내부 서버 간 통신용, 외부에서 직접 접근 불가

---

### (2) 외부 배포 방식

| 구조 | 설명 | 예시 |
|------|------|------|
| 공인 IP 직접 연결 | 서버에 공인 IP를 바로 설정 | 웹서버: 211.33.55.10 |
| NAT 변환 | 공인 IP 하나로 여러 서버가 외부 접근 | 192.168.x.x → 211.33.55.10 |
| DMZ 구성 | 외부 노출 서버만 분리된 네트워크에 배치 | DMZ 서버: 10.10.10.x |

대부분의 기업은 NAT 또는 DMZ 구조를 사용합니다.

---

## 4. 공인 IP 1개로 여러 서버 배포 가능한가?

결론: **네, 가능합니다.**

하나의 공인 IP만으로도 여러 서버나 서비스를 배포할 수 있습니다.  
방법은 아래와 같습니다.

| 방법 | 설명 | 예시 |
|------|------|------|
| **포트포워딩 (Port Forwarding)** | 공인 IP의 포트별로 다른 내부 서버로 전달 | `211.33.55.10:80` → 웹서버 / `211.33.55.10:22` → SSH 서버 |
| **리버스 프록시 (Reverse Proxy)** | Nginx/Apache가 요청을 받아 내부 서버로 분배 | `example.com/api` → 내부 API 서버, `/web` → 내부 웹서버 |
| **로드밸런서 (Load Balancer)** | 공인 IP 1개를 여러 서버로 분산 | 같은 포트의 여러 인스턴스에 트래픽 분배 |

즉, 공인 IP 1개로도 여러 서비스를 배포할 수 있지만  
**서비스별 포트 또는 도메인 구분이 필요**합니다.

---

## 5. 요약 비교

| 항목 | AWS | 온프레미스 |
|------|------|-------------|
| IP 할당 주체 | AWS가 보유한 IP 대역 | ISP(통신사)에서 기관에 제공 |
| 내부망 구조 | VPC 기반 사설망 | 물리적 라우터, 스위치로 구성 |
| 공인 IP 사용 | 자동/탄력적 할당 | 직접 설정 |
| 사설 IP 사용 | 항상 존재 (VPC CIDR) | 직접 구성 (예: 192.168.x.x) |
| 공인 IP 개수 | 여러 개 가능 | 보통 1~2개 사용 |
| 공인 IP 1개로 다중 배포 | 가능 (로드밸런서, 포트포워딩) | 가능 (NAT, 포트포워딩, DMZ) |

---

## 6. 결론

- 온프레미스 환경에서는 공인 IP 하나를 외부 배포용으로 두고,  
  내부 서버들은 사설 IP 기반으로 운영됩니다.  
- 하나의 공인 IP로도 여러 서비스를 동시에 배포할 수 있습니다.  
  (포트, 도메인, 로드밸런서 등을 이용)
- AWS는 같은 원리를 VPC 내부에서 자동화하여 제공합니다.

> 즉, 온프레미스에서는 수동으로 설정하는 네트워크 구성을  
> AWS는 “VPC + NAT + IGW + Elastic IP”로 자동화한 구조입니다.
