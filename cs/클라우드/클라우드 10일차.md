# CloudFront · Nginx · Route53 · VPC · HTTPS 정리 노트

## 1. 전체 개념 구조

웹 서비스는 크게 두 개의 영역으로 나뉜다.

### 1) 사용자(브라우저) 영역

브라우저 → 인터넷 → 서비스의 첫 진입 서버

여기서 중요한 요소: - HTTPS - CORS - 도메인 - 쿠키 - Mixed Content

### 2) 서버 내부 영역

게이트웨이 → 애플리케이션 서버 → 내부 API → DB

여기서 중요한 요소: - VPC - Private IP - Security Group - 내부 통신
방식(HTTP/HTTPS)

A/B 구조 차이는 **사용자가 어디까지 직접 접속하느냐**의 문제이고,\
Spring ↔ FastAPI 같은 내부 통신은 구조와 무관하게 동일하다.

------------------------------------------------------------------------

## 2. A 구조 vs B 구조

### A 구조 (도메인 분리형)

    브라우저
     ├─ front.myapp.com → CloudFront → 프론트
     └─ api.myapp.com   → Nginx → Spring

특징: - 브라우저가 API 서버(Nginx)에 직접 접속 - CORS 필요 - API 서버가
외부에 노출됨 - API 서버에 HTTPS 인증서 필요

### B 구조 (게이트웨이형)

    브라우저 → CloudFront → Nginx → Spring → FastAPI → DB

특징: - 브라우저는 CloudFront에만 접속 - 내부 서버는 외부에 노출되지
않음 - CORS 없음 - HTTPS는 CloudFront만 담당

핵심 차이: \> 브라우저가 직접 접속하는 서버의 개수

------------------------------------------------------------------------

## 3. HTTPS가 필요한 기준

HTTPS의 목적: \> 인터넷 구간에서 데이터 도청 방지

즉 판단 기준은: - 누가 요청했냐(X) - 인터넷을 통과하냐(O)

### 필요

브라우저 ↔ 서버 (인터넷 통신)

### 필요 없음(일반적)

서버 ↔ 서버 (내부망 통신)

------------------------------------------------------------------------

## 4. TLS Termination (SSL 종료)

B 구조에서 실제 통신:

    브라우저 --HTTPS--> CloudFront
    CloudFront --HTTP--> Nginx
    Nginx --HTTP--> Spring
    Spring --HTTP--> FastAPI

HTTPS는 CloudFront에서 끝난다.\
이를 TLS Termination이라고 한다.

따라서: - 내부 서비스는 HTTP 사용이 일반적 - 보안은 암호화가 아니라
접근제어로 해결

------------------------------------------------------------------------

## 5. VPC 내부 통신

VPC = AWS 내부 사설 네트워크

예:

    Spring EC2  : 10.0.1.11
    FastAPI EC2 : 10.0.2.22

Spring 호출:

    http://10.0.2.22:8000/analyze

특징: - 인터넷 통과 안 함 - 외부 접근 불가 - HTTP 통신 정상

### 필수 조건

1.  같은 VPC
2.  Private IP 사용
3.  Security Group 허용

------------------------------------------------------------------------

## 6. Security Group 설정

FastAPI 인바운드 규칙:

잘못된 설정:

    포트 8000 → 0.0.0.0/0

올바른 설정:

    포트 8000 → Spring EC2의 Security Group

의미: \> Spring만 FastAPI 접근 가능, 외부는 차단

------------------------------------------------------------------------

## 7. VPC가 다른 경우

### 경우 1: VPC Peering 있음

    VPC-A ↔ VPC-B

→ Private IP 통신 가능 → HTTP 사용 가능

### 경우 2: Public IP로 호출

    Spring → 인터넷 → FastAPI

→ 외부 통신 → HTTPS 필요

------------------------------------------------------------------------

## 8. Mixed Content와 내부 통신의 차이

Mixed Content는 브라우저 보안 정책이다.

발생 조건: \> HTTPS 페이지에서 브라우저가 HTTP 요청을 직접 보낼 때

예:

    https://myapp.com 페이지에서
    fetch("http://api.myapp.com/users")

브라우저가 차단한다.

### 내부 통신은 해당 없음

    브라우저 → CloudFront → Spring → FastAPI

브라우저는 FastAPI 존재를 모른다.\
따라서 Mixed Content 대상이 아니다.

------------------------------------------------------------------------

## 9. HTTP 사용 가능 여부 정리

  구간                 HTTP 가능   이유
  -------------------- ----------- --------------
  브라우저 → 서버      불가        인터넷 구간
  CloudFront → Nginx   가능        서버 간 통신
  Nginx → Spring       가능        내부망
  Spring → FastAPI     가능        VPC 내부
  Spring → DB          가능        내부망

------------------------------------------------------------------------

## 10. 핵심 정리

1.  HTTPS는 브라우저와 첫 서버 사이에서만 필수
2.  내부 마이크로서비스 통신은 일반적으로 HTTP 사용
3.  Mixed Content는 브라우저 문제이며 서버 내부 통신과 무관
4.  같은 VPC + Private IP + Security Group이면 내부 통신 가능
5.  VPC가 다르고 인터넷을 통과하면 HTTPS 필요

최종 결론:

> 내부 서버 간 통신(Spring ↔ FastAPI)은 외부 인터넷을 지나지 않으면
> HTTP로 동작하는 것이 정상적인 아키텍처이며, Mixed Content와는 관련이
> 없다.
