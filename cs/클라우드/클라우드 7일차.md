# 온프레미스(온프레미스) 서버 배포 구조 상세 설명

## 1. 온프레미스란?
온프레미스(On-Premises)는 클라우드(AWS, GCP, Azure)가 아닌, 
기업이나 기관이 **직접 보유한 서버·네트워크 장비로 시스템을 구축하고 운영하는 방식**입니다.

예를 들어 회사 내 서버실에 **물리 서버, 스위치, 방화벽, 라우터, NAS** 등이 있고,
직원들이 그 네트워크를 통해 서비스에 접근하는 환경이 온프레미스입니다.

---

## 2. 전체 네트워크 구성도

```
[인터넷]
   ↓
[ISP(통신사)]
   ↓
[공인 IP: 203.252.11.45]
   ↓
[방화벽 or 라우터]
   ├─ NAT, 포트포워딩 설정
   ↓
[스위치]
   ↓
[내부 사설망: 192.168.0.0/24]
      ├─ 웹서버 (192.168.0.10)
      ├─ API서버 (192.168.0.11)
      ├─ DB서버 (192.168.0.20)
      └─ 사내PC (192.168.0.100)
```

---

## 3. 실제 배포 흐름

### (1) 통신사에서 공인 IP 할당
- 통신사(ISP)로부터 공인 IP를 1개 또는 여러 개 할당받습니다.  
  예: `203.252.11.45`
- 이 IP는 전 세계에서 유일하며, 인터넷의 모든 사용자가 이 주소를 통해 접근할 수 있습니다.

### (2) 방화벽/라우터에서 NAT 설정
외부의 공인 IP 요청을 내부 사설 IP 서버로 전달하기 위해 **NAT(Network Address Translation)** 을 사용합니다.

| 외부 요청 (공인 IP:포트) | 내부 서버 (사설 IP:포트) | 설명 |
|------------------|-----------------|----------|
| 203.252.11.45:80 | 192.168.0.10:80 | 웹서버 HTTP |
| 203.252.11.45:443 | 192.168.0.10:443 | 웹서버 HTTPS |
| 203.252.11.45:22 | 192.168.0.11:22 | SSH 접근 |
| 203.252.11.45:3306 | 192.168.0.20:3306 | 외부 DB 접근 허용 (선택적) |

➡ 하나의 공인 IP로 여러 내부 서버 연결이 가능합니다.

---

### (3) DNS(도메인) 연결
도메인을 공인 IP에 매핑합니다.

| 도메인 | 타입 | 값 |
|---------|------|---|
| www.mycompany.com | A | 203.252.11.45 |
| api.mycompany.com | A | 203.252.11.45 |

요청은 방화벽 또는 리버스 프록시를 통해 내부 서버로 전달됩니다.

---

### (4) 리버스 프록시(Nginx) 구성 (선택)
공인 IP를 가진 서버에 Nginx를 설치하여 내부 서버로 트래픽을 분배할 수 있습니다.

```
server {
  listen 80;
  server_name www.mycompany.com;
  location / {
    proxy_pass http://192.168.0.10:80;
  }
}

server {
  listen 80;
  server_name api.mycompany.com;
  location / {
    proxy_pass http://192.168.0.11:8080;
  }
}
```

➡ 하나의 공인 IP로 여러 서비스 분배 가능 (도메인 기반)

---

## 4. 실제 배포 예시 요약

| 구분 | 서버명 | 내부 IP | 포트 | 역할 | 외부 접근 경로 |
|------|--------|----------|------|------|----------------|
| 1 | Web | 192.168.0.10 | 80, 443 | 프론트엔드 서비스 | www.mycompany.com |
| 2 | API | 192.168.0.11 | 8080 | 백엔드 API 서버 | api.mycompany.com |
| 3 | DB | 192.168.0.20 | 3306 | 데이터베이스 | 내부 접근 전용 |
| 4 | File | 192.168.0.30 | 21 | FTP 서버 | 203.252.11.45:21 |

➡ 공인 IP는 하나(`203.252.11.45`)  
➡ 내부 서버는 사설 IP 여러 개  
➡ NAT/리버스 프록시로 트래픽을 분배합니다.

---

## 5. 내부 배포와 외부 배포의 차이

| 구분 | 내부 배포 | 외부 배포 |
|------|------------|------------|
| IP | 사설 IP만 사용 | 공인 IP 필요 |
| 접근 범위 | 사내 네트워크만 | 인터넷 전체 |
| 사용 기술 | DHCP, VLAN | NAT, 포트포워딩, DNS |
| 보안 정책 | 내부 ACL | 방화벽, SSL, DMZ |
| 예시 | 사내 인트라넷, DB 서버 | 홈페이지, API 서버 |

---

## 6. DMZ 구조 (보안 강화형 배포)

```
[인터넷]
   ↓
[공인 IP] → [방화벽]
   ↓
[DMZ 네트워크: 10.10.10.0/24]
   ├─ 웹서버 10.10.10.10
   └─ 프록시서버 10.10.10.20
   ↓
[내부망: 192.168.0.0/16]
   ├─ API서버 192.168.0.11
   └─ DB서버 192.168.0.20
```

- DMZ(비무장지대): 외부와 내부망 사이의 중간 구간  
- 외부 사용자는 DMZ 서버까지만 접근 가능  
- 내부망 서버는 외부와 직접 연결되지 않음 (보안 강화)

---

## 7. 온프레미스 배포의 핵심 요약

| 항목 | 설명 |
|------|------|
| 공인 IP | ISP에서 발급받는 인터넷 연결용 IP |
| 사설 IP | 내부 서버·PC용 IP |
| NAT | 공인 ↔ 사설 IP 변환 기술 |
| 방화벽 | 외부 접근 제어, 포트 개방 설정 |
| DNS | 도메인 → 공인 IP 연결 |
| 리버스 프록시 | 공인 IP 하나로 여러 서비스 분배 |
| DMZ | 외부 서비스 구간을 내부망과 분리하여 보안 강화 |

---

## 8. 결론

- 온프레미스 환경에서는 **공인 IP + 사설 IP + NAT + 방화벽**이 핵심 구조입니다.  
- 외부 접근은 공인 IP로 받고, 내부망의 사설 IP 서버로 전달합니다.  
- 공인 IP 하나로도 여러 내부 서버에 서비스 분배 가능하며,  
- DMZ 구조를 적용하면 외부와 내부망을 안전하게 분리할 수 있습니다.
