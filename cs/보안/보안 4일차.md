# 세션 · 쿠키 · 인증 · CSRF · SSO (Opaque / JWT) 완전 정리

작성 기준  
- Spring / Spring Security 관점  
- 웹 인증 구조를 “상태(Session)”와 “신원(Authentication)”으로 분리해서 이해  
- 쿠키 / 세션 / 토큰 / SSO 개념 혼동 제거 목적

---

## 1. 세션(Session)과 인증(Authentication)의 관계

### 1.1 세션이란?
- 서버가 클라이언트를 구분하기 위해 만드는 저장 공간
- 본질은 서버 메모리/Redis 등에 존재하는 Map
- 세션 ID(JSESSIONID)는 이 저장 공간을 가리키는 식별자

```java
HttpSession session = request.getSession();
```

이 코드가 의미하는 것:
- 서버에 빈 저장 공간 생성
- 고유 ID 부여
- 그 ID를 쿠키(JSESSIONID)로 브라우저에 전달

### 핵심
- 세션은 비어 있을 수 있음
- 세션 생성 자체는 인증과 무관

---

### 1.2 인증(Authentication)이란?
- “이 사용자가 누구인지 검증되었다”는 상태
- 로그인 성공 시에만 발생
- Spring Security 기준으로는 Authentication 객체의 존재 여부가 기준

```text
인증됨 ⇔ Authentication 객체 존재
```

---

### 1.3 가장 중요한 구분
```text
세션 있음 ≠ 로그인됨
```

| 개념 | 의미 |
|---|---|
| 세션 | 상태 저장 공간 |
| 인증 | 사용자 신원 확인 결과 |

---

## 2. 쿠키는 있는데 로그인 안 된 세션 (익명 세션)

- 서버에 세션 존재
- 세션 안에 인증 정보 없음
- 서버는 사용자를 식별하지 못함

---

## 3. 로그인 시 실제 흐름

1. 로그인 요청
2. 인증 수행
3. 인증 정보 생성
4. 세션에 저장
5. 세션 ID 변경 (보안)

---

## 4. CSRF

- 쿠키 자동 전송 취약점
- 서버가 발급한 CSRF 토큰으로 요청 검증
- 세션에 저장됨

---

## 5. SSO 구조

- 중앙 인증 서버(IdP)
- 쿠키에 담긴 인증 토큰
- 여러 서비스가 토큰을 신뢰

---

## 6. Opaque Token vs JWT

| 항목 | Opaque | JWT |
|---|---|---|
| 상태 저장 | 서버 | 토큰 |
| 즉시 폐기 | 가능 | 어려움 |
| 확장성 | 보통 | 높음 |

---

## 7. 핵심 요약

세션은 공간  
인증은 정보  
쿠키는 전달 수단  
토큰은 신원 증명서
