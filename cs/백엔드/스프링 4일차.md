
# Spring Security, Spring Batch, Spring Cloud 정리

## 1️ Spring Security — 보안 담당

###  개념
Spring Security는 **스프링 애플리케이션의 로그인, 인증, 인가(권한 관리)** 를 처리하는 보안 프레임워크이다.

###  주요 개념
| 개념 | 설명 | 예시 |
|------|------|------|
| 인증(Authentication) | 사용자의 신원을 확인 | 아이디/비밀번호 로그인 |
| 인가(Authorization) | 접근 권한을 확인 | 관리자 페이지 접근 제어 |
| 필터(Filter) | 모든 요청을 가로채 검사 | 로그인 여부 확인 |
| SecurityContext | 로그인 정보 저장소 | 세션이나 토큰 기반 |

###  동작 예시
1. 사용자가 `/admin` 접근 시도
2. Security Filter가 요청을 가로챈다
3. 로그인 안 되어 있으면 로그인 페이지로 리다이렉트
4. 로그인 성공 시 SecurityContext에 사용자 정보 저장
5. 이후 요청마다 인증 검증

###  설정 예시
```java
@Configuration
@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter {
    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
            .authorizeRequests()
            .antMatchers("/admin/**").hasRole("ADMIN")
            .anyRequest().permitAll()
            .and()
            .formLogin();
    }
}
```

###  JWT 기반 인증
1. 로그인 성공 → 서버가 JWT 발급  
2. 클라이언트가 JWT를 Authorization 헤더로 전달  
3. 서버가 매번 토큰 검증 → 인증 통과 시 접근 허용

---

## 2️ Spring Batch — 대용량 데이터 처리 자동화

###  개념
Spring Batch는 **반복적이고 대량의 데이터를 자동으로 처리하는 프레임워크**이다.

###  구성 요소
| 구성 요소 | 설명 | 예시 |
|------------|------|------|
| Job | 전체 작업 단위 | "회원 데이터 정리 작업" |
| Step | Job 내부의 세부 단위 | "회원 읽기 → 처리 → 저장" |
| Chunk | Step 내 처리 묶음 | 100개씩 읽고 저장 |
| Reader | 데이터 읽기 | DB, CSV 등 |
| Processor | 데이터 가공 | 이름 대문자로 변경 |
| Writer | 데이터 저장 | 다른 DB, 파일 등 |

###  예시 코드
```java
@Bean
public Step exampleStep() {
    return stepBuilderFactory.get("exampleStep")
        .<User, User>chunk(100)
        .reader(userReader())
        .processor(userProcessor())
        .writer(userWriter())
        .build();
}
```

###  실제 사용 예
| 산업 | 사용 예시 |
|------|------------|
| 은행 | 하루 거래 내역 정리 |
| 쇼핑몰 | 상품 재고 자동 업데이트 |
| 공공기관 | 로그 파일 정리 및 백업 |

---

## 3️ Spring Cloud — 마이크로서비스 관리

###  개념
Spring Cloud는 **여러 개의 마이크로서비스(Spring Boot 애플리케이션)** 를 연결하고 관리하는 프레임워크이다.

###  주요 구성요소
| 구성요소 | 역할 | 설명 |
|-----------|-------|------|
| Eureka | 서비스 등록/탐색 | 서비스 위치 자동 관리 |
| Gateway | API 게이트웨이 | 요청 라우팅 및 인증 처리 |
| Config Server | 설정 중앙 관리 | 설정파일 일괄 관리 |
| Feign Client | 서비스 간 통신 | HTTP 요청을 인터페이스처럼 호출 |
| Circuit Breaker | 장애 복원 | 한 서비스 장애 시 전체 보호 |

###  구조 예시
```
[Gateway] → [Eureka Server] → [User-Service / Order-Service]
```

###  코드 예시
**Eureka Server**
```java
@EnableEurekaServer
@SpringBootApplication
public class EurekaServerApplication {
    public static void main(String[] args) {
        SpringApplication.run(EurekaServerApplication.class, args);
    }
}
```

**Feign Client**
```java
@FeignClient(name = "user-service")
public interface UserClient {
    @GetMapping("/users/{id}")
    User getUserById(@PathVariable Long id);
}
```

###  Spring Security와 함께 사용
- Gateway에서 JWT 인증 필터 적용
- 내부 서비스는 인증된 요청만 허용
- Eureka로 서비스 간 위치 탐색

---

## 4️ EC2와 Kubernetes 환경 비교

| 항목 | EC2 환경 | Kubernetes 환경 |
|------|-----------|----------------|
| 서비스 배포 | EC2 여러 대 | Pod 여러 개 |
| 주소 탐색 | Eureka 필요 | 내부 DNS 자동 |
| 설정 관리 | Config Server | ConfigMap / Secret |
| 확장성 | 수동 | 자동 (HPA) |
| 보안 처리 | Spring Security | 동일 적용 |
| 라우팅 | Gateway | Ingress + Gateway |

###  EC2 구조 예시
```
[Nginx] → [Gateway] → [User-Service / Order-Service]
```

###  Kubernetes 구조 예시
```
[Ingress Controller] → [Gateway Pod] → [서비스 Pod들]
```

---

## 5️ Nginx vs Spring Cloud Gateway vs Ingress

| 구분 | 위치 | 주요 기능 | 코드 가능 여부 | 환경 |
|------|------|-----------|----------------|------|
| Nginx | 서버 앞단 | 정적 파일, 프록시, HTTPS | 불가능 | EC2, On-prem |
| Spring Cloud Gateway | 애플리케이션 레벨 | 인증, 라우팅, 필터 | 가능 | Spring Cloud |
| Kubernetes Ingress | 클러스터 입구 | 트래픽 분기, SSL | 제한적 | K8s |

###  관계
```
[브라우저] → [Nginx or Ingress] → [Gateway] → [Microservices]
```

---

#  최종 요약

| 항목 | 역할 |
|------|------|
| Spring Security | 로그인, 인증, 권한 관리 |
| Spring Batch | 대량 데이터 자동 처리 |
| Spring Cloud | 마이크로서비스 통신 및 관리 |
| Nginx | 정적 파일 및 리버스 프록시 |
| Kubernetes | 컨테이너 관리 및 오케스트레이션 |
